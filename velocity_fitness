import json

def calculate_velocity_score(parent_data, tolerance=0.05):
    def calculate_distance_score(velocity, avg_velocity):
        if avg_velocity == 0 or velocity == 0:
            return 1
        
        difference = abs(velocity - avg_velocity) / avg_velocity
        
        if difference <= 0.05:
            return 20
        elif difference <= 0.10:
            return 15
        elif difference <= 0.15:
            return 10
        elif difference <= 0.20:
            return 5
        else:
            return 1

    instruments = []
    total_velocity = 0
    active_instruments = 0

    for instrument in parent_data:
        if instrument:
            velocity_mean = instrument[0].get('velocity_mean', 0)
            instruments.append({'velocity': velocity_mean})
            if velocity_mean > 0:
                total_velocity += velocity_mean
                active_instruments += 1
        else:
            instruments.append({'velocity': 0})

    v_avg = total_velocity / active_instruments if active_instruments > 0 else 0

    total_score = 0
    for instrument in instruments:
        score = calculate_distance_score(instrument['velocity'], v_avg)
        total_score += score

    return total_score
